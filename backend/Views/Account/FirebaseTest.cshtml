@{
    ViewData["Title"] = "Firebase Authentication Test";
    Layout = "~/Views/Shared/_AccountLayout.cshtml";
}

<div class="account-container">
    <div class="account-box">
        <h2 class="text-center mb-4">Firebase Authentication Test</h2>
        
        <div class="mb-3">
            <button type="button" id="testGoogleSignIn" class="btn btn-google w-100 mb-2">
                <i class="fab fa-google"></i>
                Test Google Sign-In
            </button>
        </div>
        
        <div class="mb-3">
            <input type="email" id="testEmail" class="form-control mb-2" placeholder="Test Email">
            <input type="password" id="testPassword" class="form-control mb-2" placeholder="Test Password">
            <button type="button" id="testEmailSignIn" class="btn btn-primary w-100 mb-2">
                Test Email Sign-In
            </button>
            <button type="button" id="testEmailRegister" class="btn btn-success w-100 mb-2">
                Test Email Register
            </button>
        </div>
        
        <div class="mb-3">
            <button type="button" id="testSignOut" class="btn btn-secondary w-100 mb-2">
                Sign Out
            </button>
        </div>
        
        <div id="testResults" class="mt-3">
            <h5>Test Results:</h5>
            <pre id="resultOutput" style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-size: 12px;"></pre>
        </div>
        
        <div class="text-center">
            <a asp-controller="Account" asp-action="Login" class="text-decoration-none">Back to Login</a>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="~/js/firebase-auth.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const resultOutput = document.getElementById('resultOutput');
            
            function logResult(message) {
                const timestamp = new Date().toLocaleTimeString();
                resultOutput.textContent += `[${timestamp}] ${message}\n`;
                resultOutput.scrollTop = resultOutput.scrollHeight;
            }
            
            // Test Google Sign-In
            document.getElementById('testGoogleSignIn').addEventListener('click', async function() {
                try {
                    logResult('Testing Google Sign-In...');
                    const result = await window.FirebaseAuth.signInWithGoogle();
                    logResult(`Google Sign-In Result: ${JSON.stringify(result, null, 2)}`);
                } catch (error) {
                    logResult(`Google Sign-In Error: ${error.message}`);
                }
            });
            
            // Test Email Sign-In
            document.getElementById('testEmailSignIn').addEventListener('click', async function() {
                const email = document.getElementById('testEmail').value;
                const password = document.getElementById('testPassword').value;
                
                if (!email || !password) {
                    logResult('Please enter email and password');
                    return;
                }
                
                try {
                    logResult('Testing Email Sign-In...');
                    const result = await window.FirebaseAuth.signInWithEmail(email, password);
                    logResult(`Email Sign-In Result: ${JSON.stringify(result, null, 2)}`);
                } catch (error) {
                    logResult(`Email Sign-In Error: ${error.message}`);
                }
            });
            
            // Test Email Register
            document.getElementById('testEmailRegister').addEventListener('click', async function() {
                const email = document.getElementById('testEmail').value;
                const password = document.getElementById('testPassword').value;
                
                if (!email || !password) {
                    logResult('Please enter email and password');
                    return;
                }
                
                try {
                    logResult('Testing Email Registration...');
                    const result = await window.FirebaseAuth.registerWithEmail(email, password);
                    logResult(`Email Registration Result: ${JSON.stringify(result, null, 2)}`);
                } catch (error) {
                    logResult(`Email Registration Error: ${error.message}`);
                }
            });
            
            // Test Sign Out
            document.getElementById('testSignOut').addEventListener('click', async function() {
                try {
                    logResult('Testing Sign Out...');
                    await window.FirebaseAuth.signOut();
                    logResult('Sign Out Successful');
                } catch (error) {
                    logResult(`Sign Out Error: ${error.message}`);
                }
            });
            
            // Monitor auth state changes
            window.FirebaseAuth.onAuthStateChanged(function(user) {
                if (user) {
                    logResult(`Auth State Changed: User signed in - ${user.email}`);
                } else {
                    logResult('Auth State Changed: User signed out');
                }
            });
            
            logResult('Firebase Test Page Loaded');
        });
    </script>
}