@{
    ViewData["Title"] = Localizer["Title.SearchLocalServices"];
}
<div class="container py-4">
    <h2 class="mb-3">@Localizer["Heading.SearchLocalServices"]</h2>
    <div class="card">
        <div class="card-header d-flex gap-2 align-items-center flex-wrap">
            <select id="loc" class="form-select w-auto">
                <option selected>Kattappana</option>
                <option>Nedumkandam</option>
                <option>Kanjirappally</option>
                <option>Kumily</option>
                <option>Kuttikkanam</option>
            </select>
            <select id="cat" class="form-select w-auto"></select>
            <input id="q" class="form-control" placeholder="@Localizer["SearchLocalPlaceholder"]">
            <button class="btn btn-primary" id="btnSearch" title="@Localizer["Search"]"><i class="fas fa-search"></i></button>
        </div>
        <div class="p-3">
            <style>
                /* Quick predefined cards */
                .osm-quick-cards { display:grid; grid-template-columns: repeat(4,1fr); gap:16px; }
                .osm-card { 
                    background: linear-gradient(135deg, #ffffff 0%, #f6faff 100%);
                    border:1px solid #e2e8f0; border-radius:16px; padding:18px 16px; cursor:pointer; 
                    display:flex; align-items:center; gap:14px; transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease; box-shadow:0 2px 6px rgba(0,0,0,.04);
                }
                .osm-card i{ display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px; border-radius:10px; background: linear-gradient(135deg, #3b82f6, #2563eb); color:#fff; font-size:18px; }
                .osm-card span{ font-weight:600; font-size:1rem; color:#0f172a; }
                .osm-card:hover{ box-shadow:0 12px 24px rgba(37,99,235,.15); transform: translateY(-3px); border-color:#c7d2fe; }
                @@media (max-width: 992px){ .osm-quick-cards{ grid-template-columns: repeat(3,1fr);} }
                @@media (max-width: 576px){ .osm-quick-cards{ grid-template-columns: repeat(2,1fr);} }
                /* Category tiles */
                .category-card.tile{ border-radius:12px; border:1px solid #e5e7eb; transition: box-shadow .2s ease, transform .2s ease; }
                .category-card.tile:hover{ box-shadow:0 10px 20px rgba(0,0,0,.08); transform: translateY(-2px); }
                .category-card .card-title{ font-size:1.125rem; }
            </style>
            <div class="osm-quick-cards" id="quickCards">
                <div class="osm-card" data-name="Hospital"><i class="fas fa-hospital"></i><span>@Localizer["Quick.Hospital"]</span></div>
                <div class="osm-card" data-name="Pharmacy"><i class="fas fa-prescription-bottle-alt"></i><span>@Localizer["Quick.Pharmacy"]</span></div>
                <div class="osm-card" data-name="Clinic"><i class="fas fa-clinic-medical"></i><span>@Localizer["Quick.Clinic"]</span></div>
                <div class="osm-card" data-name="Police Station"><i class="fas fa-shield-alt"></i><span>@Localizer["Quick.Police"]</span></div>
                <div class="osm-card" data-name="Fuel / Gas Station"><i class="fas fa-gas-pump"></i><span>@Localizer["Quick.Fuel"]</span></div>
                <div class="osm-card" data-name="Restaurant"><i class="fas fa-utensils"></i><span>@Localizer["Quick.Restaurant"]</span></div>
                <div class="osm-card" data-name="Cafe"><i class="fas fa-coffee"></i><span>@Localizer["Quick.Cafe"]</span></div>
                <div class="osm-card" data-name="Fast Food"><i class="fas fa-hamburger"></i><span>@Localizer["Quick.FastFood"]</span></div>
                <div class="osm-card" data-name="Bank / ATM"><i class="fas fa-university"></i><span>@Localizer["Quick.BankATM"]</span></div>
                <div class="osm-card" data-name="Post Office"><i class="fas fa-mail-bulk"></i><span>@Localizer["Quick.PostOffice"]</span></div>
                <div class="osm-card" data-name="School"><i class="fas fa-school"></i><span>@Localizer["Quick.School"]</span></div>
                <div class="osm-card" data-name="University"><i class="fas fa-graduation-cap"></i><span>@Localizer["Quick.University"]</span></div>
                <div class="osm-card" data-name="Bus Stop"><i class="fas fa-bus"></i><span>@Localizer["Quick.BusStop"]</span></div>
                <div class="osm-card" data-name="Train Station"><i class="fas fa-train"></i><span>@Localizer["Quick.Train"]</span></div>
                <div class="osm-card" data-name="Airport"><i class="fas fa-plane"></i><span>@Localizer["Quick.Airport"]</span></div>
                <div class="osm-card" data-name="Taxi Stand"><i class="fas fa-taxi"></i><span>@Localizer["Quick.Taxi"]</span></div>
                <div class="osm-card" data-name="Park / Garden"><i class="fas fa-tree"></i><span>@Localizer["Quick.Park"]</span></div>
                <div class="osm-card" data-name="Playground"><i class="fas fa-futbol"></i><span>@Localizer["Quick.Playground"]</span></div>
                <div class="osm-card" data-name="Cinema / Movie Theater"><i class="fas fa-film"></i><span>@Localizer["Quick.Cinema"]</span></div>
                <div class="osm-card" data-name="Museum"><i class="fas fa-landmark"></i><span>@Localizer["Quick.Museum"]</span></div>
                <div class="osm-card" data-name="Art Gallery"><i class="fas fa-palette"></i><span>@Localizer["Quick.ArtGallery"]</span></div>
                <div class="osm-card" data-name="Hotel"><i class="fas fa-bed"></i><span>@Localizer["Quick.Hotel"]</span></div>
                <div class="osm-card" data-name="Guest House"><i class="fas fa-concierge-bell"></i><span>@Localizer["Quick.GuestHouse"]</span></div>
                <div class="osm-card" data-name="Parking Lot / Garage"><i class="fas fa-parking"></i><span>@Localizer["Quick.Parking"]</span></div>
                <div class="osm-card" data-name="Ferry Terminal"><i class="fas fa-ship"></i><span>@Localizer["Quick.Ferry"]</span></div>
                
                <!-- Essential Services -->
                <div class="osm-card" data-name="Grocery Store"><i class="fas fa-shopping-basket"></i><span>@Localizer["Quick.GroceryStore"]</span></div>
                <div class="osm-card" data-name="Supermarket"><i class="fas fa-store"></i><span>@Localizer["Quick.Supermarket"]</span></div>
                <div class="osm-card" data-name="Medical Store"><i class="fas fa-pills"></i><span>@Localizer["Quick.MedicalStore"]</span></div>
                <div class="osm-card" data-name="Dentist"><i class="fas fa-tooth"></i><span>@Localizer["Quick.Dentist"]</span></div>
                
                <!-- Professional Services -->
                <div class="osm-card" data-name="Lawyer"><i class="fas fa-balance-scale"></i><span>@Localizer["Quick.Lawyer"]</span></div>
                <div class="osm-card" data-name="Accountant"><i class="fas fa-calculator"></i><span>@Localizer["Quick.Accountant"]</span></div>
                <div class="osm-card" data-name="Car Repair"><i class="fas fa-wrench"></i><span>@Localizer["Quick.CarRepair"]</span></div>
                <div class="osm-card" data-name="Plumber"><i class="fas fa-tools"></i><span>@Localizer["Quick.Plumber"]</span></div>
                <div class="osm-card" data-name="Electrician"><i class="fas fa-plug"></i><span>@Localizer["Quick.Electrician"]</span></div>
                
                <!-- Personal Care -->
                <div class="osm-card" data-name="Barber Shop"><i class="fas fa-cut"></i><span>@Localizer["Quick.BarberShop"]</span></div>
                <div class="osm-card" data-name="Beauty Salon"><i class="fas fa-spa"></i><span>@Localizer["Quick.BeautySalon"]</span></div>
                <div class="osm-card" data-name="Gym"><i class="fas fa-dumbbell"></i><span>@Localizer["Quick.Gym"]</span></div>
                
                <!-- Shopping -->
                <div class="osm-card" data-name="Clothing Store"><i class="fas fa-tshirt"></i><span>@Localizer["Quick.ClothingStore"]</span></div>
                <div class="osm-card" data-name="Electronics Store"><i class="fas fa-tv"></i><span>@Localizer["Quick.ElectronicsStore"]</span></div>
                <div class="osm-card" data-name="Mobile Shop"><i class="fas fa-mobile"></i><span>@Localizer["Quick.MobileShop"]</span></div>
                <div class="osm-card" data-name="Bakery"><i class="fas fa-bread-slice"></i><span>@Localizer["Quick.Bakery"]</span></div>
                
                <!-- Transportation -->
                <div class="osm-card" data-name="Auto Stand"><i class="fas fa-taxi"></i><span>@Localizer["Quick.AutoStand"]</span></div>
                <div class="osm-card" data-name="Car Rental"><i class="fas fa-car"></i><span>@Localizer["Quick.CarRental"]</span></div>
                
                <!-- Religious -->
                <div class="osm-card" data-name="Temple"><i class="fas fa-place-of-worship"></i><span>@Localizer["Quick.Temple"]</span></div>
                <div class="osm-card" data-name="Church"><i class="fas fa-cross"></i><span>@Localizer["Quick.Church"]</span></div>
                <div class="osm-card" data-name="Mosque"><i class="fas fa-mosque"></i><span>@Localizer["Quick.Mosque"]</span></div>
            </div>
        </div>
        <div id="tileGrid" class="p-3">
            <div class="text-muted">@Localizer["LoadingCategories"]</div>
        </div>
</div>
<script>
    function navigateToBrowse(params){
        const url = new URL(location.origin + '/local/services/browse');
        if(params.q) url.searchParams.set('q', params.q);
        if(params.categorySlug) url.searchParams.set('categorySlug', params.categorySlug);
        if(params.locationName) url.searchParams.set('locationName', params.locationName);
        location.href = url.toString();
    }

    function renderTiles(cats){
        const grid = document.getElementById('tileGrid');
        grid.innerHTML = '';
        const row = document.createElement('div');
        row.className = 'row g-4';
        cats.forEach(c => {
            const col = document.createElement('div');
            col.className = 'col-12 col-md-6 col-lg-3';
            col.innerHTML = `<div class="card h-100 tile category-card" data-slug="${c.slug}">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex align-items-center mb-2">
                        <i class="bi bi-geo-alt-fill me-2 text-primary"></i>
                        <h5 class="card-title mb-0">${c.name}</h5>
                    </div>
                    <p class="card-text text-muted small">@Localizer["ClickToViewServices"]</p>
                    <div class="mt-auto text-end">
                        <button class="btn btn-outline-primary btn-sm">@Localizer["View"]</button>
                    </div>
                </div>
            </div>`;
            row.appendChild(col);
        });
        grid.appendChild(row);
        grid.querySelectorAll('.tile').forEach(tile => {
            tile.addEventListener('click', ()=>{
                const slug = tile.getAttribute('data-slug');
                const loc = document.getElementById('loc').value;
                navigateToBrowse({ q: '', categorySlug: slug, locationName: loc });
            });
        });
    }

    async function loadCats(){
        const sel = document.getElementById('cat');
        sel.innerHTML = '<option value="">All Categories</option>';
        try{
            const res = await fetch('/api/local/categories');
            const cats = await res.json();
            // Populate dropdown with all categories (unchanged)
            cats.forEach(c => {
                const o = document.createElement('option');
                o.value = c.slug;
                o.textContent = c.name;
                sel.appendChild(o);
            });
            // Exclude bottom duplicate tiles for Hospital, Police, Fuel/Petrol
            const filtered = cats.filter(c => {
                const n = (c.name || '').toLowerCase();
                return !(n.includes('hospital') || n.includes('police') || n.includes('fuel') || n.includes('petrol'));
            });
            renderTiles(filtered);
        }catch{ document.getElementById('tileGrid').innerHTML = '<div class="text-danger">Failed to load categories.</div>'; }
    }

    document.addEventListener('DOMContentLoaded', async ()=>{
        await loadCats();
        document.getElementById('btnSearch').addEventListener('click', () => {
            const q = document.getElementById('q').value.trim();
            const cat = document.getElementById('cat').value;
            const loc = document.getElementById('loc').value;
            navigateToBrowse({ q, categorySlug: cat, locationName: loc });
        });
        document.querySelectorAll('#quickCards .osm-card').forEach(el => {
            el.addEventListener('click', () => {
                const name = el.getAttribute('data-name');
                const loc = document.getElementById('loc').value;
                navigateToBrowse({ q: name, categorySlug: '', locationName: loc });
            });
        });
    });
</script>