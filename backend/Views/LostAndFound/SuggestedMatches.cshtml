@model ServConnect.ViewModels.SuggestedMatchesViewModel
@{
    ViewData["Title"] = "AI Suggested Matches";
}

<style>
    :root {
        --primary: #10B981;
        --primary-dark: #059669;
        --primary-light: #34D399;
        --bg-light: #ffffff;
        --bg-section: #f8fafc;
        --bg-card: #ffffff;
        --bg-card-hover: #f9fafb;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --border-color: #e5e7eb;
        --gradient-primary: linear-gradient(135deg, #10B981 0%, #059669 100%);
        --shadow-sm: 0 4px 6px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 10px 25px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 25px 50px rgba(0, 0, 0, 0.15);
        --shadow-glow: 0 10px 40px rgba(16, 185, 129, 0.3);
    }

    body {
        background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 50%, #d1fae5 100%);
        min-height: 100vh;
    }

    .matches-container {
        padding: 40px 15px;
        max-width: 1600px;
        margin: 0 auto;
    }

    .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        color: var(--text-primary);
        border-radius: 50px;
        text-decoration: none;
        font-weight: 500;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
        margin-bottom: 30px;
    }

    .back-btn:hover {
        transform: translateX(-5px);
        box-shadow: var(--shadow-md);
        color: var(--primary);
        border-color: var(--primary);
        text-decoration: none;
    }

    .matches-header {
        text-align: center;
        margin-bottom: 40px;
        animation: fadeInDown 0.8s ease-out;
    }

    .matches-header h1 {
        font-size: 3rem;
        font-weight: 800;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 16px;
    }

    .matches-header p {
        font-size: 1.15rem;
        color: var(--text-secondary);
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.8;
    }

    .ai-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 24px;
        background: var(--gradient-primary);
        color: white;
        border-radius: 50px;
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 20px;
        box-shadow: var(--shadow-glow);
    }

    .ai-badge i {
        animation: pulse 2s infinite;
    }

    .info-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        border-radius: 20px;
        padding: 24px 30px;
        margin-bottom: 40px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
        display: flex;
        align-items: flex-start;
        gap: 16px;
    }

    .info-card .icon {
        width: 48px;
        height: 48px;
        background: var(--gradient-primary);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .info-card .content h6 {
        color: var(--text-primary);
        font-weight: 700;
        margin-bottom: 6px;
        font-size: 1rem;
    }

    .info-card .content p {
        color: var(--text-secondary);
        margin: 0;
        font-size: 0.9rem;
        line-height: 1.6;
    }

    .error-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        border-radius: 24px;
        padding: 60px 40px;
        text-align: center;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
    }

    .error-card .icon-wrap {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px;
    }

    .error-card .icon-wrap i {
        font-size: 2rem;
        color: #EF4444;
    }

    .error-card h4 {
        color: var(--text-primary);
        font-weight: 700;
        margin-bottom: 12px;
        font-size: 1.5rem;
    }

    .error-card p {
        color: var(--text-secondary);
        max-width: 400px;
        margin: 0 auto;
    }

    .matches-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
        gap: 30px;
    }

    .match-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        border-radius: 24px;
        overflow: hidden;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        animation: fadeInUp 0.6s ease-out;
    }

    .match-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary);
    }

    .match-header {
        background: var(--gradient-primary);
        padding: 18px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .match-header h5 {
        color: white;
        margin: 0;
        font-weight: 600;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .match-percentage {
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(8px);
        padding: 8px 20px;
        border-radius: 50px;
        color: white;
        font-weight: 700;
        font-size: 1rem;
    }

    .match-content {
        padding: 24px;
    }

    .items-comparison {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 16px;
        align-items: stretch;
    }

    .item-box {
        background: #f9fafb;
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
    }

    .item-box:hover {
        border-color: var(--primary);
    }

    .item-box.lost {
        background: linear-gradient(180deg, #fef2f2 0%, #ffffff 100%);
    }

    .item-box.found {
        background: linear-gradient(180deg, #f0fdf4 0%, #ffffff 100%);
    }

    .item-label {
        display: block;
        padding: 10px 16px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        text-align: center;
    }

    .item-label.lost {
        background: #EF4444;
        color: white;
    }

    .item-label.found {
        background: var(--primary);
        color: white;
    }

    .item-image {
        width: 100%;
        height: 180px;
        overflow: hidden;
        position: relative;
    }

    .item-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .item-box:hover .item-image img {
        transform: scale(1.05);
    }

    .item-image .placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
    }

    .item-image .placeholder i {
        font-size: 3rem;
        opacity: 0.3;
    }

    .item-info {
        padding: 16px;
    }

    .item-title {
        font-size: 1rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 8px;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .item-category {
        display: inline-block;
        padding: 4px 12px;
        background: rgba(16, 185, 129, 0.1);
        color: var(--primary-dark);
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .item-location {
        font-size: 0.8rem;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .item-location i {
        color: var(--primary);
        font-size: 0.75rem;
    }

    .match-connector {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 8px;
    }

    .connector-icon {
        width: 44px;
        height: 44px;
        background: var(--gradient-primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1rem;
        box-shadow: var(--shadow-glow);
    }

    .match-actions {
        padding: 20px 24px;
        background: #f9fafb;
        border-top: 1px solid var(--border-color);
        display: flex;
        gap: 12px;
    }

    .action-btn {
        flex: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 20px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.85rem;
        text-decoration: none;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
    }

    .action-btn i {
        font-size: 0.8rem;
    }

    .action-btn.view-found {
        background: var(--gradient-primary);
        color: white;
    }

    .action-btn.view-found:hover {
        box-shadow: var(--shadow-glow);
        transform: translateY(-2px);
        color: white;
        text-decoration: none;
    }

    .action-btn.view-lost {
        background: white;
        color: var(--text-primary);
        border: 2px solid var(--border-color);
    }

    .action-btn.view-lost:hover {
        border-color: var(--primary);
        color: var(--primary);
        text-decoration: none;
    }

    .empty-state {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        border-radius: 24px;
        text-align: center;
        padding: 80px 40px;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--border-color);
    }

    .empty-state .icon-wrap {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px;
    }

    .empty-state .icon-wrap i {
        font-size: 2.5rem;
        color: var(--primary);
    }

    .empty-state h3 {
        font-size: 1.5rem;
        color: var(--text-primary);
        font-weight: 700;
        margin-bottom: 12px;
    }

    .empty-state p {
        color: var(--text-secondary);
        max-width: 500px;
        margin: 0 auto 30px;
        line-height: 1.7;
    }

    .empty-state .action-btn {
        background: var(--gradient-primary);
        color: white;
        padding: 14px 32px;
        border-radius: 50px;
    }

    .empty-state .action-btn:hover {
        box-shadow: var(--shadow-glow);
        transform: translateY(-3px);
        color: white;
        text-decoration: none;
    }

    .stats-row {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-bottom: 40px;
    }

    .stat-item {
        text-align: center;
        padding: 20px 30px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 16px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
    }

    .stat-item .number {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--primary);
    }

    .stat-item .label {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-top: 4px;
    }

    @@keyframes fadeInDown {
        from { opacity: 0; transform: translateY(-30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @@keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @@keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.6; }
    }

    @@media (max-width: 1100px) {
        .matches-grid {
            grid-template-columns: 1fr;
        }
    }

    @@media (max-width: 600px) {
        .matches-header h1 { font-size: 2rem; }
        .items-comparison { grid-template-columns: 1fr; gap: 12px; }
        .match-connector { padding: 12px 0; }
        .connector-icon { transform: rotate(90deg); }
        .match-actions { flex-direction: column; }
        .stats-row { flex-direction: column; gap: 16px; }
    }
</style>

<div class="matches-container">
    <a asp-action="MyLostItems" class="back-btn">
        <i class="fas fa-arrow-left"></i> Back to My Lost Items
    </a>

    <div class="matches-header">
        <span class="ai-badge"><i class="fas fa-robot"></i> Powered by S-BERT AI</span>
        <h1><i class="fas fa-magic me-3"></i>AI Suggested Matches</h1>
        <p>Our AI analyzes your lost items and finds potential matches from found items based on semantic similarity</p>
    </div>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="error-card">
            <div class="icon-wrap">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h4>Service Unavailable</h4>
            <p>@Model.ErrorMessage</p>
        </div>
    }
    else if (!Model.IsServiceAvailable)
    {
        <div class="error-card">
            <div class="icon-wrap">
                <i class="fas fa-server"></i>
            </div>
            <h4>AI Service Offline</h4>
            <p>The AI matching service is currently unavailable. Please try again later or contact support.</p>
        </div>
    }
    else if (Model.Matches.Count == 0)
    {
        <div class="empty-state">
            <div class="icon-wrap">
                <i class="fas fa-search"></i>
            </div>
            <h3>No Matches Found</h3>
            <p>We couldn't find any potential matches for your lost items at this time. This could mean there are no similar found items reported yet, or you don't have any active lost item reports.</p>
            <a asp-action="Index" class="action-btn">
                <i class="fas fa-search"></i> Browse Found Items Manually
            </a>
        </div>
    }
    else
    {
        <div class="stats-row">
            <div class="stat-item">
                <div class="number">@Model.Matches.Count</div>
                <div class="label">Potential Matches</div>
            </div>
            <div class="stat-item">
                <div class="number">@Model.Matches.Max(m => m.MatchPercentage).ToString("F0")%</div>
                <div class="label">Best Match</div>
            </div>
        </div>

        <div class="info-card">
            <div class="icon">
                <i class="fas fa-lightbulb"></i>
            </div>
            <div class="content">
                <h6>How AI Matching Works</h6>
                <p>Our S-BERT AI model analyzes the title, description, category, and location of items to find semantic similarities. Higher match percentages indicate stronger potential matches. Always verify the item details before claiming.</p>
            </div>
        </div>

        <div class="matches-grid">
            @foreach (var match in Model.Matches)
            {
                <div class="match-card">
                    <div class="match-header">
                        <h5><i class="fas fa-link"></i> Potential Match</h5>
                        <span class="match-percentage">@match.MatchPercentage.ToString("F0")% Match</span>
                    </div>
                    <div class="match-content">
                        <div class="items-comparison">
                            <div class="item-box lost">
                                <span class="item-label lost">Your Lost Item</span>
                                <div class="item-image">
                                    @if (match.LostReport.Images.Count > 0)
                                    {
                                        <img src="@match.LostReport.Images[0]" alt="@match.LostReport.Title">
                                    }
                                    else
                                    {
                                        <div class="placeholder"><i class="fas fa-image" style="color: #EF4444;"></i></div>
                                    }
                                </div>
                                <div class="item-info">
                                    <h4 class="item-title">@match.LostReport.Title</h4>
                                    <span class="item-category">@match.LostReport.Category</span>
                                    <p class="item-location"><i class="fas fa-map-marker-alt"></i> @match.LostReport.LostLocation</p>
                                </div>
                            </div>
                            <div class="match-connector">
                                <div class="connector-icon">
                                    <i class="fas fa-exchange-alt"></i>
                                </div>
                            </div>
                            <div class="item-box found">
                                <span class="item-label found">Found Item</span>
                                <div class="item-image">
                                    @if (match.FoundItem.Images.Count > 0)
                                    {
                                        <img src="@match.FoundItem.Images[0]" alt="@match.FoundItem.Title">
                                    }
                                    else
                                    {
                                        <div class="placeholder"><i class="fas fa-image" style="color: var(--primary);"></i></div>
                                    }
                                </div>
                                <div class="item-info">
                                    <h4 class="item-title">@match.FoundItem.Title</h4>
                                    <span class="item-category">@match.FoundItem.Category</span>
                                    <p class="item-location"><i class="fas fa-map-marker-alt"></i> @match.FoundItem.FoundLocation</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="match-actions">
                        <a asp-action="LostItemDetails" asp-route-id="@match.LostReport.Id" class="action-btn view-lost">
                            <i class="fas fa-eye"></i> View Lost Item
                        </a>
                        <a asp-action="Details" asp-route-id="@match.FoundItem.Id" class="action-btn view-found">
                            <i class="fas fa-hand-paper"></i> View & Claim
                        </a>
                    </div>
                </div>
            }
        </div>
    }
</div>
